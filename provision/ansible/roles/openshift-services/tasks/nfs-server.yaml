- name: Start services
  ansible.builtin.service:
    name: "{{item}}"
    state: started
    enabled: true
  loop:
    - rpcbind
    - nfs-server

- name: Ensure group "nobody" exists
  ansible.builtin.group:
    name: nobody
    state: present

- name: Create a mountable directory if it does not exist
  ansible.builtin.file:
    path: /mnt/nfs_server
    state: directory
    owner: nobody
    group: nobody
    mode: "0777"

- name: Copy exports file.
  ansible.builtin.template:
    src: exports.j2
    dest: /etc/exports
    owner: root
    group: root
    mode: 0644

- name: NFS apply change configrue
  ansible.builtin.shell: exportfs -a;

- name: Restart services
  ansible.builtin.service:
    name: "{{item}}"
    state: restarted
    enabled: true
  loop:
    - rpcbind
    - nfs-server
