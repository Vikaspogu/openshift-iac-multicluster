---
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: newrelic-scaledobject
  namespace: custom-metrics-test
spec:
  maxReplicaCount: 3
  minReplicaCount: 1
  pollingInterval: 30
  scaleTargetRef:
    name: server-http-newrelic
  triggers:
    - type: new-relic
      metadata:
        nrql: "SELECT rate(count(apm.service.transaction.duration), 1 minute) as 'Web throughput' FROM Metric WHERE (appName = 'HTTP Server App Test') AND (transactionType = 'Web') LIMIT MAX SINCE 60 seconds AGO"
        noDataError: "true"
        threshold: "10000"
      authenticationRef:
        name: keda-cluster-trigger-auth-new-relic
        kind: ClusterTriggerAuthentication
