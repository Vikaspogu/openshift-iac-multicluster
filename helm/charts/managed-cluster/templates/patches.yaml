---
apiVersion: redhatcop.redhat.io/v1alpha1
kind: Patch
metadata:
  name: agent-patches
  namespace: {{.Values.cluster.name}}
  labels:
    {{- include "managed-cluster.labels" . | nindent 4 }}
spec:
  serviceAccountRef:
    name: default
  patches:
    agents-patch:
      targetObjectRef:
        apiVersion: agent-install.openshift.io/v1beta1
        kind: Agent
        namespace: {{.Values.cluster.inventoryName}}
        labelSelector:
          matchExpressions:
            - key: acm-ai
              operator: In
              {{- with .Values.cluster.hosts }}
              values:
              {{- toYaml . | nindent 16 }}
              {{- end }}
      patchTemplate: |
        spec:
          clusterDeploymentName:
            name: {{.Values.cluster.name}}
            namespace: {{.Values.cluster.name}}
      patchType: application/merge-patch+json
