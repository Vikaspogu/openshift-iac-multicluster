{{- $values := .Values -}}
{{- range $index, $node := $values.nodes }}
---
apiVersion: agent-install.openshift.io/v1beta1
kind: NMStateConfig
metadata:
  name: {{$index}}
  namespace: {{ $values.cluster.name }}
  labels:
    acm-ai-sno: {{ $values.cluster.name }}
spec:
  interfaces:
  {{- range $index,$interface := $node.interfaces }}
    - name: {{ $index }}
      macAddress: {{ $interface }}
  {{- end  }}
  config:
    {{- range $index, $interface := $node.interfacesConfig }}
    interfaces:
      - name: {{ $index }}
        type: {{ $interface.type }}
        state: up
        {{- with $interface.network }}
          {{- toYaml . | nindent 8 }}
        {{- end }}
    {{- end  }}
    dns-resolver:
      config:
        {{- with $values.dnsResolvers }}
        server:
          {{- toYaml . | nindent 8 }}
        {{- end }}
    routes:
      {{- with $values.routesConfig }}
      config:
        {{- toYaml . | nindent 8 }}
      {{- end }}
{{- end }}
