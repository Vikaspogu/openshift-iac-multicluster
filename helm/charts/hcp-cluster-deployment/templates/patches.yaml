
apiVersion: redhatcop.redhat.io/v1alpha1
kind: Patch
metadata:
  name: agent-patches-{{ .Values.clusterName }}
  namespace: {{ .Values.clusterName }}
  labels:
    {{- include "hcp-cluster-deployment.labels" . | nindent 4 }}
spec:
  serviceAccountRef:
    name: default
  patches:
{{- if .Values.automaticHostBinding }}
    agents-patch:
      targetObjectRef:
        apiVersion: agent-install.openshift.io/v1beta1
        kind: Agent
        namespace: {{ .Values.inventoryName }}
        labelSelector:
          matchExpressions:
            - key: infraenvs.agent-install.openshift.io
              operator: In
              values:
                - {{ .Values.inventoryName }}
      patchTemplate: |
        spec:
          approved: true
          clusterDeploymentName:
            name: {{ .Values.clusterName }}
            namespace: {{ .Values.clusterName }}-{{ .Values.clusterName }}
      patchType: application/merge-patch+json
{{ end }}
