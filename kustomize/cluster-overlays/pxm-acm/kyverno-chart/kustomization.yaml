---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
namespace: kyverno
resources:
  - ../../../bases/kyverno-chart/

commonAnnotations:
  argocd.argoproj.io/sync-options: ServerSideApply=true

helmCharts:
  - name: kyverno
    releaseName: kyverno
    namespace: kyverno
    repo: https://kyverno.github.io/kyverno/
    version: 3.0.1
    valuesInline:
      crds:
        install: true
      backgroundController:
        rbac:
          clusterRole:
            extraResources:
              - apiGroups:
                  - ""
                resources:
                  - pods
              - apiGroups:
                  - batch
                resources:
                  - cronjobs
                  - jobs
      admissionController:
        replicas: 3
        rbac:
          clusterRole:
            extraResources:
              - apiGroups:
                  - ""
                resources:
                  - pods
                  - cronjobs
                verbs:
                  - create
                  - update
                  - delete
              - verbs:
                  - create
                  - delete
                  - deletecollection
                  - patch
                  - update
                apiGroups:
                  - batch
                resources:
                  - cronjobs
                  - jobs
